# Canvas AI Orchestration Platform - 서버 구성도

## 전체 아키텍처 개요

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           Canvas AI Orchestration Platform                      │
│                              서버 구성도                                        │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Load Balancer │    │   CDN/Static    │    │   DNS Service   │
│   (NGINX/ALB)   │    │   Assets        │    │   (Route53)     │
└─────────┬───────┘    └─────────────────┘    └─────────────────┘
          │
          ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              Ingress Layer                                     │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                │
│  │   NGINX         │  │   SSL/TLS       │  │   Rate Limiting │                │
│  │   Ingress       │  │   Termination   │  │   & Security    │                │
│  │   Controller    │  │   (cert-manager)│  │   Headers       │                │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                │
└─────────────────────────────────────────────────────────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           Application Layer                                     │
│                                                                                 │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                │
│  │   Canvas App    │  │   Canvas App    │  │   Canvas App    │                │
│  │   (NestJS)      │  │   (NestJS)      │  │   (NestJS)      │                │
│  │   Pod 1         │  │   Pod 2         │  │   Pod 3         │                │
│  │   Port: 3000    │  │   Port: 3000    │  │   Port: 3000    │                │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                │
│                                                                                 │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                │
│  │   Plugin        │  │   Workflow      │  │   Model         │                │
│  │   System        │  │   Engine        │  │   Router        │                │
│  │   Service       │  │   Service       │  │   Service       │                │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                │
└─────────────────────────────────────────────────────────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                             Data Layer                                          │
│                                                                                 │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                │
│  │   MongoDB       │  │   Redis         │  │   OpenSearch    │                │
│  │   Replica Set   │  │   Cluster       │  │   Cluster       │                │
│  │   (3 nodes)     │  │   (3 nodes)     │  │   (3 nodes)     │                │
│  │   Port: 27017   │  │   Port: 6379    │  │   Port: 9200    │                │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                │
│                                                                                 │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                │
│  │   Persistent    │  │   Persistent    │  │   Persistent    │                │
│  │   Volume        │  │   Volume        │  │   Volume        │                │
│  │   (MongoDB)     │  │   (Redis)       │  │   (OpenSearch)  │                │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                │
└─────────────────────────────────────────────────────────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                          External Services                                      │
│                                                                                 │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                │
│  │   AWS Bedrock   │  │   OpenAI API    │  │   Anthropic     │                │
│  │   (Claude,      │  │   (GPT Models)  │  │   (Claude API)  │                │
│  │   Titan Models) │  │                 │  │                 │                │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                │
│                                                                                 │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                │
│  │   AWS S3        │  │   AWS Lambda    │  │   External      │                │
│  │   (File Storage)│  │   (Functions)   │  │   APIs          │                │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                │
└─────────────────────────────────────────────────────────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           Monitoring Layer                                      │
│                                                                                 │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                │
│  │   Prometheus    │  │   Grafana       │  │   AlertManager  │                │
│  │   (Metrics      │  │   (Dashboards   │  │   (Alerts &     │                │
│  │   Collection)   │  │   & Visualization)│  │   Notifications)│                │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                │
│                                                                                 │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                │
│  │   Jaeger        │  │   ELK Stack     │  │   Custom        │                │
│  │   (Distributed  │  │   (Logging)     │  │   Metrics       │                │
│  │   Tracing)      │  │                 │  │   (Business)    │                │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## Kubernetes 네임스페이스 구조

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           Kubernetes Namespaces                                 │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│   Development   │  │   Staging       │  │   Production    │
│   Namespace     │  │   Namespace     │  │   Namespace     │
│                 │  │                 │  │                 │
│   canvas-       │  │   canvas-       │  │   canvas-       │
│   orchestration-│  │   orchestration-│  │   orchestration │
│   dev           │  │   staging       │  │                 │
└─────────────────┘  └─────────────────┘  └─────────────────┘
```

## 네트워크 토폴로지

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              Network Topology                                   │
└─────────────────────────────────────────────────────────────────────────────────┘

                    ┌─────────────────┐
                    │   Internet      │
                    └─────────┬───────┘
                              │
                    ┌─────────▼───────┐
                    │   Load Balancer │
                    │   (External)    │
                    └─────────┬───────┘
                              │
                    ┌─────────▼───────┐
                    │   Kubernetes    │
                    │   Cluster       │
                    │                 │
                    │  ┌─────────────┐│
                    │  │   Master    ││
                    │  │   Nodes     ││
                    │  └─────────────┘│
                    │                 │
                    │  ┌─────────────┐│
                    │  │   Worker    ││
                    │  │   Node 1    ││
                    │  └─────────────┘│
                    │                 │
                    │  ┌─────────────┐│
                    │  │   Worker    ││
                    │  │   Node 2    ││
                    │  └─────────────┘│
                    │                 │
                    │  ┌─────────────┐│
                    │  │   Worker    ││
                    │  │   Node 3    ││
                    │  └─────────────┘│
                    └─────────────────┘
```

## 서비스 간 통신 흐름

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           Service Communication Flow                            │
└─────────────────────────────────────────────────────────────────────────────────┘

Client Request
      │
      ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   NGINX     │───▶│   Canvas    │───▶│   Plugin    │
│   Ingress   │    │   App       │    │   System    │
└─────────────┘    └─────────────┘    └─────────────┘
                           │
                           ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Workflow  │◀───│   Model     │───▶│   MongoDB   │
│   Engine    │    │   Router    │    │   Database  │
└─────────────┘    └─────────────┘    └─────────────┘
                           │
                           ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Redis     │    │   OpenSearch│    │   AWS       │
│   Cache     │    │   Search    │    │   Bedrock   │
└─────────────┘    └─────────────┘    └─────────────┘
```

## 리소스 할당 및 스케일링

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                        Resource Allocation & Scaling                           │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│   Development   │  │   Staging       │  │   Production    │
│                 │  │                 │  │                 │
│   Canvas App:   │  │   Canvas App:   │  │   Canvas App:   │
│   1 replica     │  │   2 replicas    │  │   3-20 replicas │
│   256Mi RAM     │  │   512Mi RAM     │  │   1Gi RAM       │
│   100m CPU      │  │   250m CPU      │  │   500m CPU      │
│                 │  │                 │  │                 │
│   MongoDB:      │  │   MongoDB:      │  │   MongoDB:      │
│   1 replica     │  │   2 replicas    │  │   3 replicas    │
│   512Mi RAM     │  │   1Gi RAM       │  │   2Gi RAM       │
│   250m CPU      │  │   500m CPU      │  │   1000m CPU     │
│                 │  │                 │  │                 │
│   Redis:        │  │   Redis:        │  │   Redis:        │
│   1 replica     │  │   2 replicas    │  │   3 replicas    │
│   128Mi RAM     │  │   256Mi RAM     │  │   512Mi RAM     │
│   50m CPU       │  │   100m CPU      │  │   250m CPU      │
└─────────────────┘  └─────────────────┘  └─────────────────┘
```

## 보안 및 네트워크 정책

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           Security & Network Policies                          │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Network       │    │   Pod Security  │    │   RBAC          │
│   Policies      │    │   Standards     │    │   (Role-Based   │
│   (Micro-       │    │   (Non-root,    │    │   Access        │
│   segmentation) │    │   Read-only     │    │   Control)      │
│                 │    │   filesystem)   │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   TLS/SSL       │    │   Resource      │    │   Secret        │
│   Encryption    │    │   Limits        │    │   Management    │
│   (In-transit)  │    │   (CPU/Memory)  │    │   (K8s Secrets) │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Data          │    │   Health        │    │   Backup        │
│   Encryption    │    │   Checks        │    │   & Recovery    │
│   (At-rest)     │    │   (Liveness/    │    │   (Automated)   │
│                 │    │   Readiness)    │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 배포 파이프라인

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              Deployment Pipeline                               │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Code      │───▶│   Build     │───▶│   Test      │───▶│   Deploy    │
│   Commit    │    │   (Docker)  │    │   (Unit/    │    │   (K8s)     │
│             │    │             │    │   E2E)      │    │             │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       │                   │                   │                   │
       ▼                   ▼                   ▼                   ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   GitHub    │    │   GitHub    │    │   Jest/     │    │   Helm/     │
│   Actions   │    │   Registry  │    │   Cypress   │    │   Kustomize │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
```

## 모니터링 및 로깅

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           Monitoring & Logging Stack                           │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Application│   │   System    │    │   Business  │    │   Security  │
│   Metrics    │   │   Metrics   │    │   Metrics   │    │   Metrics   │
│   (Custom)   │   │   (K8s)     │    │   (Custom)  │    │   (Audit)   │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       │                   │                   │                   │
       ▼                   ▼                   ▼                   ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Prometheus│    │   Grafana   │    │   AlertManager│   │   Jaeger    │
│   (Collect) │    │   (Viz)     │    │   (Alert)   │    │   (Trace)   │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       │                   │                   │                   │
       ▼                   ▼                   ▼                   ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   ELK Stack │    │   Custom    │    │   Slack/    │    │   Log       │
│   (Logs)    │    │   Dashboards│    │   Email     │    │   Analysis  │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
```

## 주요 특징

### 1. **고가용성 (High Availability)**
- 모든 서비스의 다중 복제본
- Pod Anti-Affinity로 노드 분산
- 자동 장애 복구 (Self-healing)

### 2. **자동 스케일링 (Auto-scaling)**
- HPA (Horizontal Pod Autoscaler)
- VPA (Vertical Pod Autoscaler)
- 클러스터 자동 스케일링

### 3. **보안 (Security)**
- 네트워크 정책으로 마이크로세그멘테이션
- TLS/SSL 암호화
- RBAC 권한 관리
- Pod Security Standards

### 4. **모니터링 (Monitoring)**
- Prometheus 메트릭 수집
- Grafana 대시보드
- 분산 추적 (Jaeger)
- 중앙화된 로깅

### 5. **CI/CD 파이프라인**
- GitHub Actions 자동화
- 다중 환경 배포
- 롤링 업데이트
- 자동 롤백

이 구성도는 Canvas AI Orchestration Platform의 **프로덕션급 아키텍처**를 보여주며, **확장성**, **안정성**, **보안성**을 모두 고려한 설계입니다.
